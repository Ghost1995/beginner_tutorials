# ROS Publisher/Subscriber
[![License](https://img.shields.io/badge/License-BSD%203--Clause-blue.svg)](https://opensource.org/licenses/BSD-3-Clause)
---

## Overview

This program is a basic implementation of a publisher and a subscriber in ROS. It has been generated by creating a catkin package, editing the default package.xml and CMakeLists.txt, and then creating two nodes, a publisher (talker) node and a subscriber (listener) node to demonstarte how they interact with each other. A launch file has also been created which launches both publisher and subscriber nodes.

## Dependencies

This program works on a device running Ubuntu 16.04 and ROS Kinetic.

To install ROS Kinetic in Ubuntu 16.04, follow the steps in this [link](http://wiki.ros.org/kinetic/Installation/Ubuntu).

To install catkin, follow the installation steps in this [link](http://wiki.ros.org/catkin).

## Build Instructions

To build this code in a catkin workspace:
```
cd ~/catkin_ws/
catkin_make
source devel/setup.bash
cd src/
git clone -b Week11_HW --single-branch https://github.com/Ghost1995/beginner_tutorials.git
cd ..
catkin_make
```
Note, that if you do not have a catkin workspace, then to build this code use the following commands:
```
mkdir -p ~/catkin_ws/src
cd ~/catkin_ws/
catkin_make
source devel/setup.bash
cd src/
git clone -b Week11_HW --single-branch https://github.com/Ghost1995/beginner_tutorials.git
cd ..
catkin_make
```

## Run Instructions

### 1) Use Launch File

* **Use the Default Frequency**

After following the build instructions, launch the code:
```
source ~/catkin_ws/devel/setup.bash
roslaunch beginner_tutorials nodes.launch 
```
* **Use User-defined Frequency**

After following the build instructions, launch the code with frequency as argument:
```
source ~/catkin_ws/devel/setup.bash
roslaunch beginner_tutorials nodes.launch f:=<desiredFrequency>
```

### 2) Run each node separately

To run this code, three terminals are required.

Set environment vairables and run roscore in Terminal 1:
```
source ~/catkin_ws/devel/setup.bash
roscore
```
Set environment variables and run publisher (talker) node in Terminal 2:
```
source ~/catkin_ws/devel/setup.bash
rosrun beginner_tutorials talker
```
Set environment variables and run subscriber (listener) node in Terminal 3:
```
source ~/catkin_ws/devel/setup.bash
rosrun beginner_tutorials listener
```

## Use ROS Service

After running the code by following either one of the run instructions, both the talker and listener nodes will be active. Now, open a new terminal and start the service:

### 1) Run the Service to Edit the Base Output String

```
source ~/catkin_ws/devel/setup.bash
rosservice call /editString "str: '<desiredString>'"
``` 

### 2) Run the Service to Set the Maximum Strings to be Published

```
source ~/catkin_ws/devel/setup.bash
rosservice call /setMaxCount "count: <desiredMaximumCount>"
``` 

## View the tf Frames

The tf broadcaster in the talker node creates a tf transform between the "world" frame and the "talk" frame as shown in the attached [PDF](https://github.com/Ghost1995/beginner_tutorials/blob/Week11_HW/results/view_frames%20result.pdf). This is a time varying broadcaster with both the translation and rotation varying with time. It can be viewed by using "tf_echo".

After running the code by following either one of the run instructions, both the talker and listener nodes will be active. Note that, listener node is not required for viewing tf frames.

Now, open a new terminal and use the following commands to view the tf frames in the command window:
```
source ~/catkin_ws/devel/setup.bash
rosrun tf tf_echo /world /talk
```
To visualize the tf frames in a graph form, run the following commands:
```
source ~/catkin_ws/devel/setup.bash
rosrun rqt_tf_tree rqt_tf_tree 
```
To generate the PDF showing the broadcaster architecture, run the following commands:
```
source ~/catkin_ws/devel/setup.bash
rosrun tf view_frames
```
The above command generates a PDF file. To view this PDF generated from the command window, run the following command:
```
evince frames.pdf
```

## Run Tests

There are 3 tests written for the talker node and added in the test directory. The first two tests check if the services being called are working correctly and the third one checks if the broadcaster in the talker node is working as expected. The tests created use rostest and gtest as base.

### 1) Run the Tests while Compiling the Code

You can run the tests while building the code by running the following commands:
```
cd ~/catkin_ws
catkin_make run_tests_beginner_tutorials
```

### 2) Run the Tests after Compiling the Code

After compiling the code by following the build instructions, to run the tests independently, use the following commands:
```
source ~/catkin_ws/devel/setup.bash
rostest beginner_tutorials allTests.test
```

### 3) Run the Tests after Running the Code

After running the code by following either one of the run instructions, both the talker and listener nodes will be active. Note that, similar to viewing the tf frames, listener node is not required for running the tests.

Now, open a new terminal and use the following commands to run the tests:
```
source ~/catkin_ws/devel/setup.bash
rosrun beginner_tutorials allTests
```

## Record bag File

A ros bag file records all the topic and messages being published in the terminal. To record a bag file, just enable recording in the launch file using the following commands:
```
source ~/catkin_ws/devel/setup.bash
roslaunch beginner_tutorials nodes.launch record:=enable
```
Note that, the bag file is saved in the results folder by default.

### Inspecting the bag File Generated

To get more information about the generated rosbag file, such as the data being recorded, the time duration, the size of the bag file, and so on, use the following commands:
```
cd <path to directory>/results
rosbag info record.bag
```

### Playing the bag File Generated

The rosbag file records all the messages being published on to the terminal. To check if the messages were recorded properly, you can playback the recorded rosbag file.

After running the code by following either one of the run instructions, both the talker and listener nodes will be active. Note that, close the talker node if it is running, otherwise the listener node will be echoing the data from both the talker node and the rosbag file.

Now, open a new terminal and use the following commands:
```
cd <path to directory>/results
rosbag play record.bag
```
The listener node will echo all the messages being published on topic /chatter.

## Plugins
##### CppChEclipse
To run cppcheck in Terminal
```
cd <path to directory>
cppcheck --enable=all --std=c++11 --suppress=* $(find . -name *.cpp -or -name *.hpp)
```
##### Google C++ Sytle
To check Google C++ Style formatting in Terminal
```
cd <path to directory>
cpplint $(find . -name *.cpp -or -name *.hpp)
```
